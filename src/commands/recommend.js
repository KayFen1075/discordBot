const { SlashCommandBuilder } = require('@discordjs/builders');
const { Client, StringSelectMenuBuilder, ActionRowBuilder, ButtonBuilder, GatewayIntentBits, EmbedBuilder, PermissionsBitField, Permissions, MessageManager, Embed, Collection, Colors } = require('discord.js');
const { game_table } = require('../functions/listFunc.js')

const { Configuration, OpenAIApi } = require("openai");

const configuration = new Configuration({
  apiKey: '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',
});
const openai = new OpenAIApi(configuration);

module.exports = {
data: new SlashCommandBuilder()
    .setName('recommend')
    .setDescription('–ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –≤–æ —á—Ç–æ –º–æ–∂–Ω–æ –ø–æ–∏–≥—Ä–∞—Ç—å'),
    async execute(interaction) {
        try {
            const response = await openai.createCompletion({
                model: "text-davinci-003",
                prompt: `–¢–≤–æ—è –∑–∞–¥–∞—á–∞ —Å–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ –∫–∞–∫—É—é –∏–≥—Ä—É –º–æ–∂–Ω–æ –ø–æ–∏–≥—Ä–∞—Ç—å –µ–º—É –∏ –µ–≥–æ –¥—Ä—É–∑—å—è–º. –¢—ã –ø–æ–ª—É—á–∞–µ—à—å —Å–ø–∏—Å–æ–∫ –∏–≥—Ä, –≥–¥–µ üü• - —ç—Ç–æ –Ω–µ—Ç—É –≤ —Å–ø–∏—Å–∫–µ, üü® - –Ω–µ—Ç—É –∂–µ–ª–∞–Ω–∏—è —Å–µ–π—á–∞—Å –∏–≥—Ä–∞—Ç—å, üü© - –≥–æ—Ç–æ–≤ –∏–≥—Ä–∞—Ç—å.–¢–µ–±–µ –Ω—É–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∂–∞–Ω—Ä—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫—Ç–æ —á—Ç–æ –≤–æ —á—Ç–æ –∏–≥—Ä–∞–µ—Ç –∏ –≤—ã–±—Ä–∞—Ç—å —Ç—Ä–∏ –∏–≥—Ä—ã, –Ω–µ –±–æ–ª—å—à–µ.–¢–µ–±–µ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω–æ –ø–∏—Å–∞—Ç—å –µ—â—ë —á—Ç–æ-—Ç–æ –∫—Ä–æ–º–µ –Ω–∞–∑–≤–∞–Ω–∏–π –∏–≥—Ä(—Ä–µ–∫–æ–º–µ–Ω–¥—É—é –∏ —Ç.–¥. –∑–∞–ø—Ä–µ—â–µ–Ω–Ω–æ).–¢–∞–∫ –∂–µ —Ç–µ–±–µ –Ω–∞–¥–æ –≤—ã–±–∏—Ä–∞—Ç—å —Å —Ç–∞–∫–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏:1. –ï—Å–ª–∏ –∏–≥—Ä—ã –Ω–µ—Ç—É —É –∫–æ–≥–æ-—Ç–æ –∏ –æ–Ω–∞ –º–∞–ª–æ –≤–µ—Å–∏—Ç —Ç–æ –º–æ–∂–Ω–æ –µ—ë —É—á–∏—Ç–æ–≤–∞—Ç—å –∏ –æ–Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è 2. –ï—Å–ª–∏ –∏–≥—Ä–∞ –º–∞–ª–æ —É –∫–æ–≥–æ –µ—Å—Ç—å –µ—ë –Ω–µ —É—á–∏—Ç—ã–≤–∞—Ç—å3. –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –∞–Ω–¥—Ä–æ–∏–¥ –∏–≥—Ä—ã –∏ –∫—Ä–∞—Ç–∫—É—é –∏—Å—Ç–æ—Ä–∏, –ø–∏—Å–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é —Ç–æ–ª—å–∫–æ –ø—Ä–æ –ø–∫ –∏–≥—Ä—ã. 5. –¢–µ–±–µ –Ω–∞–¥–æ —É—á–∏—Ç—ã–≤–∞—Ç—å —Ü–µ–Ω—É –∏–≥—Ä—ã, –µ—Å–ª–∏ —É –∫–æ–≥–æ-—Ç–æ –µ—ë –Ω–µ—Ç—É –∏ –æ–Ω–∞ –ø–ª–∞—Ç–Ω–∞—è —Ç–æ –µ—ë –∑–∞–ø—Ä–µ—â–µ–Ω–Ω–æ –¥–æ–≤–ª—è—Ç—å –≤ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏!6. –í —Å–ø–∏—Å–∫–µ –µ—Å—Ç—å –ø–ª–∞—Ç–Ω—ã–µ –∏–≥—Ä—ã —Ç–∞–∫ —á—Ç–æ —Ç—ã —ç—Ç–æ —É—á–∏—Ç—ã–≤–∞–π –∏ –ø—Ä–æ–≤–µ—Ä—è–π –∫–∞–∂–¥—É—é –∏–∑ –Ω–∏—Ö.7. –ó–∞–ø—Ä–µ—â–µ–Ω–Ω–æ –ø–∏—Å–∞—Ç—å –∏–≥—Ä—ã –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç—É –≤ —Å–ø–∏—Å–∫–µ.8. –¢–∞–∫ –∂–µ –Ω–µ –∑–∞–±—ã–≤–∞–π, –µ—Å–ª–∏ —á–µ–ª–æ–≤–µ–∫ –Ω–µ —Ö–æ—á–µ—Ç –∏–≥—Ä–∞—Ç—å, —ç—Ç–æ –Ω–µ –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ –æ–Ω –Ω–µ –º–æ–∂–µ—Ç –∏–≥—Ä–∞—Ç—å, –∞ –≤–æ—Ç –µ—Å–ª–∏ –æ–Ω –Ω–µ –º–æ–∂–µ—Ç –∏–≥—Ä–∞—Ç—å —Ç–æ –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –Ω–µ –¥–æ–±–∞–≤–ª—è—Ç—å –≤ —Å–ø–∏—Å–æ–∫.9. –¢–∞–∫ –∂–µ —Ç–µ–±–µ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω–æ –ø–∏—Å–∞—Ç—å –∏–≥—Ä—ã –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç—É —É –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞. –ö –ø—Ä–∏–º–µ—Ä—É –µ—Å—Ç—å –∏–≥—Ä–∞ –∫–æ—Ç–æ—Ä–∞—è –µ—Å—Ç—å —É –æ–¥–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞, –∞ —É –¥—Ä—É–≥–∏—Ö –Ω–µ—Ç—É. \n –ß–µ–ª–æ–≤–µ–∫: ${game_table()[2]} AI: –°–º–æ—Ç—Ä—è –Ω–∞ –≤–∞—à–∏ –≤–∫—É—Å—ã –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è, —è –º–æ–≥—É –ø–æ—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å –ø–æ–π—Ç–∏ —Å–µ–π—á–∞—Å –≤ —Ç–∞–∫—É—é –∏–≥—Ä—É:`,
                temperature: 0,
                max_tokens: 100,
                top_p: 0,
                frequency_penalty: 0,
                presence_penalty: 0,
                stop: [" –ß–µ–ª–æ–≤–µ–∫:", " AI:"],
              });
            const responseText = await response.data.choices[0].text
            console.log(responseText);
            await interaction.channel.send({content: `${responseText} üòò`,
            tts: true,
            embeds: [new EmbedBuilder()
                .setTitle('üì® –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è')
                .setDescription(`–°–º–æ—Ç—Ä—è –Ω–∞ –≤–∞—à–∏ –≤–∫—É—Å—ã –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è, —è –º–æ–≥—É –ø–æ—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å –ø–æ–π—Ç–∏ —Å–µ–π—á–∞—Å –≤ —Ç–∞–∫—É—é –∏–≥—Ä—É: \n\`\`\`${responseText}\`\`\``)
                .setColor(Colors.Aqua)
            ]})    
        } catch (error) {
            console.error;
        }
    }
}