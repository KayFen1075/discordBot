const { SlashCommandBuilder } = require('@discordjs/builders');
const { Client, StringSelectMenuBuilder, ActionRowBuilder, ButtonBuilder, GatewayIntentBits, EmbedBuilder, PermissionsBitField, Permissions, MessageManager, Embed, Collection, Colors } = require('discord.js');
const { game_table } = require('../functions/listFunc.js')
const fs = require('fs')

const { Configuration, OpenAIApi } = require("openai");
const { fileLog } = require('../functions/logs.js');


const configuration = new Configuration({
  apiKey: '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',
});
const openai = new OpenAIApi(configuration);

module.exports = {
data: new SlashCommandBuilder()
    .setName('recommend')
    .setDescription('–ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –≤–æ —á—Ç–æ –º–æ–∂–Ω–æ –ø–æ–∏–≥—Ä–∞—Ç—å'),
    async execute(interaction) {
        try {
            const response = await openai.createCompletion({
model: "text-davinci-003",
prompt: `–í–∞—à–∞ –∑–∞–¥–∞—á–∞ - –ø–æ—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å –∏–≥—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏ –µ–≥–æ –¥—Ä—É–∑—å—è–º. –í–∞–º –±—É–¥–µ—Ç –¥–∞–Ω —Å–ø–∏—Å–æ–∫ –∏–≥—Ä, –≥–¥–µ üü• –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∏–≥—Ä—ã –Ω–µ—Ç –≤ —Å–ø–∏—Å–∫–µ, üü® –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –Ω–∏–∫—Ç–æ –Ω–µ –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω –≤ –∏–≥—Ä–µ —Å–µ–π—á–∞—Å, –∞ üü© –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∫—Ç–æ-—Ç–æ —Ö–æ—á–µ—Ç –≤ –Ω–µ–µ –ø–æ–∏–≥—Ä–∞—Ç—å. –í–∞–º –Ω—É–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –∂–∞–Ω—Ä—ã, –ø–æ–Ω—è—Ç—å, –∫—Ç–æ –≤–æ —á—Ç–æ –∏–≥—Ä–∞–µ—Ç, –∏ –≤—ã–±—Ä–∞—Ç—å –¥–æ —Ç—Ä–µ—Ö –∏–≥—Ä. –í–∞—à–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –Ω–∞ —Ç—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
–ò–≥—Ä—ã, –≤ –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –∏–≥—Ä–∞—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å
–ò–≥—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –æ–±–µ—Å–ø–µ—á–∏—Ç—å –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–µ
–ò–≥—Ä—ã, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ —Å–ø–∏—Å–∫–µ
–í–∞–º —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –ø–∏—Å–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞–∑–≤–∞–Ω–∏—è –∏–≥—Ä –≤ –≤–∞—à–µ–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, –±–µ–∑ –∫–∞–∫–∏—Ö-–ª–∏–±–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ (—Ç–∞–∫–∏—Ö –∫–∞–∫ "—è —Ä–µ–∫–æ–º–µ–Ω–¥—É—é" –∏–ª–∏ "–∏ —Ç.–¥."). –ö—Ä–æ–º–µ —Ç–æ–≥–æ, –≤—ã –¥–æ–ª–∂–Ω—ã —Å–ª–µ–¥–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –ø—Ä–∞–≤–∏–ª–∞–º:

–ï—Å–ª–∏ –∏–≥—Ä—ã –Ω–µ—Ç –≤ —Å–ø–∏—Å–∫–µ, –Ω–æ —É –Ω–µ–µ –º–∞–ª–µ–Ω—å–∫–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞, –≤—ã –º–æ–∂–µ—Ç–µ –≤–∫–ª—é—á–∏—Ç—å –µ–µ –≤ —Å–ø–∏—Å–æ–∫, –∏ –æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ–π.
–ï—Å–ª–∏ –≤ –∏–≥—Ä—É –∏–≥—Ä–∞–µ—Ç –≤—Å–µ–≥–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–µ–ª–æ–≤–µ–∫, –µ–µ –Ω–µ —Å–ª–µ–¥—É–µ—Ç –≤–∫–ª—é—á–∞—Ç—å.
–†–µ–∫–æ–º–µ–Ω–¥—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –∏–≥—Ä—ã –¥–ª—è –ü–ö, –∏–≥–Ω–æ—Ä–∏—Ä—É—è –∏–≥—Ä—ã –¥–ª—è Android –∏ –∫—Ä–∞—Ç–∫—É—é –∏—Å—Ç–æ—Ä–∏—é.
–£—á–∏—Ç—ã–≤–∞–π—Ç–µ —Ü–µ–Ω—É –∏–≥—Ä—ã. –ï—Å–ª–∏ –∏–≥—Ä–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–µ –≤—Å–µ–º –∏ —è–≤–ª—è–µ—Ç—Å—è –ø–ª–∞—Ç–Ω–æ–π, –µ–µ –Ω–µ —Å–ª–µ–¥—É–µ—Ç –≤–∫–ª—é—á–∞—Ç—å –≤ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é.
–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∏–≥—Ä—ã –≤ —Å–ø–∏—Å–∫–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–ª–∞—Ç–Ω—ã–º–∏, –ø–æ—ç—Ç–æ–º—É –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∫–∞–∂–¥—É—é –∏–∑ –Ω–∏—Ö.
–ù–µ –≤–∫–ª—é—á–∞–π—Ç–µ –∏–≥—Ä—ã, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ —Å–ø–∏—Å–∫–µ.
–ù–µ –ø–∏—à–∏ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∏–≥—Ä—ã, 3-5 —Ö–≤–∞—Ç–∏—Ç.
–î–æ–±–∞–≤–ª—è–π –æ—Ç—Å—Ç—É–ø—ã.
–ü–∏—Å–∞—Ç—å –∏–≥—Ä—ã –≤ –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –∏–≥—Ä–∞—Ç—å –æ—Ç 2 —á–µ–ª–æ–≤–µ–∫, –æ–¥–∏–Ω–æ—á–Ω—ã–µ –∏–≥—Ä—ã —Å—Ç—Ä–æ–≥–æ –∑–∞–ø—Ä–µ—â–µ–Ω—ã –≤ —Å–ø–∏—Å–∫–µ.
–ï—Å–ª–∏ —á–µ–ª–æ–≤–µ–∫ –Ω–µ —Ö–æ—á–µ—Ç –∏–≥—Ä–∞—Ç—å –≤ –∏–≥—Ä—É, —ç—Ç–æ –Ω–µ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –æ–Ω –Ω–µ –º–æ–∂–µ—Ç –≤ –Ω–µ–µ –∏–≥—Ä–∞—Ç—å. –û–¥–Ω–∞–∫–æ –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –º–æ–≥—É—Ç –≤ –Ω–µ–µ –∏–≥—Ä–∞—Ç—å, –µ–µ –Ω–µ —Å–ª–µ–¥—É–µ—Ç –≤–∫–ª—é—á–∞—Ç—å –≤ —Å–ø–∏—Å–æ–∫.
–ö—Ä–æ–º–µ —Ç–æ–≥–æ, –Ω–µ –≤–∫–ª—é—á–∞–π—Ç–µ –≤ —Å–ø–∏—Å–æ–∫ –∏–≥—Ä—ã, –≤ –∫–æ—Ç–æ—Ä—ã–µ –∏–≥—Ä–∞–µ—Ç –ª–∏—à—å –º–µ–Ω—å—à–∏–Ω—Å—Ç–≤–æ –ª—é–¥–µ–π. –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –≤ –∏–≥—Ä—É –∏–≥—Ä–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —á–µ–ª–æ–≤–µ–∫, –Ω–æ –Ω–µ –∏–≥—Ä–∞—é—Ç –¥—Ä—É–≥–∏–µ".
–ê –≤–æ—Ç –ø—Ä–∏–º–µ—Ä —Ä–∞–∑–≥–æ–≤–æ—Ä–∞, –æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–≥–æ –Ω–∞ —ç—Ç–æ–º –∑–∞–ø—Ä–æ—Å–µ:
User: *list*
AI:
1 –ò–≥—Ä—ã, –≤ –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –∏–≥—Ä–∞—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å:
games..

2 –ò–≥—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –æ–±–µ—Å–ø–µ—á–∏—Ç—å –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–µ:
games..

3 –ò–≥—Ä—ã, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ —Å–ø–∏—Å–∫–µ:
games..

User: ${game_table()[2]}
AI:`,
                  temperature: 0,
                  max_tokens: 1000,
                  top_p: 0,
                  frequency_penalty: 0,
                  presence_penalty: 0,
                  stop: ["User:", "AI:"],
                });
            const responseText = await response.data.choices[0].text
            console.log(responseText);
            await interaction.channel.send({content: `${responseText}`,
            embeds: [new EmbedBuilder()
                .setTitle('üì® –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è')
                .setDescription(`–°–º–æ—Ç—Ä—è –Ω–∞ –≤–∞—à–∏ –≤–∫—É—Å—ã –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è, —è –º–æ–≥—É –ø–æ—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å –ø–æ–π—Ç–∏ —Å–µ–π—á–∞—Å –≤ —Ç–∞–∫—É—é –∏–≥—Ä—É: \n\`\`\`${responseText}\`\`\``)
                .setColor(Colors.Aqua)
            ]})    
            let bot = JSON.parse(fs.readFileSync('./src/dataBase/bot.json'))
             bot.recomend = responseText
             fs.writeFileSync('./src/dataBase/bot.json', JSON.stringify(bot))
             fileLog(`[RECOMEND] ${interaction.user.username} (${interaction.user.id}) –ø–æ–ª—É—á–∏–ª —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é: ${responseText}`)
        } catch (error) {
            console.error;
        }
    }
}